{"ast":null,"code":"import _classCallCheck from \"/Users/natewamwenze/Documents/personalProjects/musicidea/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/natewamwenze/Documents/personalProjects/musicidea/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _inherits from \"/Users/natewamwenze/Documents/personalProjects/musicidea/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper from \"/Users/natewamwenze/Documents/personalProjects/musicidea/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\nimport { deactivateAudioGraph } from '../helpers/deactivate-audio-graph';\nimport { isValidLatencyHint } from '../helpers/is-valid-latency-hint';\nexport var createAudioContextConstructor = function createAudioContextConstructor(baseAudioContextConstructor, createInvalidStateError, createNotSupportedError, createUnknownError, mediaElementAudioSourceNodeConstructor, mediaStreamAudioDestinationNodeConstructor, mediaStreamAudioSourceNodeConstructor, mediaStreamTrackAudioSourceNodeConstructor, nativeAudioContextConstructor) {\n  return /*#__PURE__*/function (_baseAudioContextCons) {\n    _inherits(AudioContext, _baseAudioContextCons);\n\n    var _super = _createSuper(AudioContext);\n\n    function AudioContext() {\n      var _this;\n\n      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n      _classCallCheck(this, AudioContext);\n\n      if (nativeAudioContextConstructor === null) {\n        throw new Error('Missing the native AudioContext constructor.');\n      }\n\n      var nativeAudioContext;\n\n      try {\n        nativeAudioContext = new nativeAudioContextConstructor(options);\n      } catch (err) {\n        // Bug #192 Safari does throw a SyntaxError if the sampleRate is not supported.\n        if (err.code === 12 && err.message === 'sampleRate is not in range') {\n          throw createNotSupportedError();\n        }\n\n        throw err;\n      } // Bug #131 Safari returns null when there are four other AudioContexts running already.\n\n\n      if (nativeAudioContext === null) {\n        throw createUnknownError();\n      } // Bug #51 Only Chrome, Edge and Opera throw an error if the given latencyHint is invalid.\n\n\n      if (!isValidLatencyHint(options.latencyHint)) {\n        throw new TypeError(\"The provided value '\".concat(options.latencyHint, \"' is not a valid enum value of type AudioContextLatencyCategory.\"));\n      } // Bug #150 Safari does not support setting the sampleRate.\n\n\n      if (options.sampleRate !== undefined && nativeAudioContext.sampleRate !== options.sampleRate) {\n        throw createNotSupportedError();\n      }\n\n      _this = _super.call(this, nativeAudioContext, 2);\n      var latencyHint = options.latencyHint;\n      var _nativeAudioContext = nativeAudioContext,\n          sampleRate = _nativeAudioContext.sampleRate; // @todo The values for 'balanced', 'interactive' and 'playback' are just copied from Chrome's implementation.\n\n      _this._baseLatency = typeof nativeAudioContext.baseLatency === 'number' ? nativeAudioContext.baseLatency : latencyHint === 'balanced' ? 512 / sampleRate : latencyHint === 'interactive' || latencyHint === undefined ? 256 / sampleRate : latencyHint === 'playback' ? 1024 / sampleRate :\n      /*\n       * @todo The min (256) and max (16384) values are taken from the allowed bufferSize values of a\n       * ScriptProcessorNode.\n       */\n      Math.max(2, Math.min(128, Math.round(latencyHint * sampleRate / 128))) * 128 / sampleRate;\n      _this._nativeAudioContext = nativeAudioContext; // Bug #188: Safari will set the context's state to 'interrupted' in case the user switches tabs.\n\n      if (nativeAudioContextConstructor.name === 'webkitAudioContext') {\n        _this._nativeGainNode = nativeAudioContext.createGain();\n        _this._nativeOscillatorNode = nativeAudioContext.createOscillator();\n        _this._nativeGainNode.gain.value = 1e-37;\n\n        _this._nativeOscillatorNode.connect(_this._nativeGainNode).connect(nativeAudioContext.destination);\n\n        _this._nativeOscillatorNode.start();\n      } else {\n        _this._nativeGainNode = null;\n        _this._nativeOscillatorNode = null;\n      }\n\n      _this._state = null;\n      /*\n       * Bug #34: Chrome, Edge and Opera pretend to be running right away, but fire an onstatechange event when the state actually\n       * changes to 'running'.\n       */\n\n      if (nativeAudioContext.state === 'running') {\n        _this._state = 'suspended';\n\n        var revokeState = function revokeState() {\n          if (_this._state === 'suspended') {\n            _this._state = null;\n          }\n\n          nativeAudioContext.removeEventListener('statechange', revokeState);\n        };\n\n        nativeAudioContext.addEventListener('statechange', revokeState);\n      }\n\n      return _this;\n    }\n\n    _createClass(AudioContext, [{\n      key: \"baseLatency\",\n      get: function get() {\n        return this._baseLatency;\n      }\n    }, {\n      key: \"state\",\n      get: function get() {\n        return this._state !== null ? this._state : this._nativeAudioContext.state;\n      }\n    }, {\n      key: \"close\",\n      value: function close() {\n        var _this2 = this;\n\n        // Bug #35: Firefox does not throw an error if the AudioContext was closed before.\n        if (this.state === 'closed') {\n          return this._nativeAudioContext.close().then(function () {\n            throw createInvalidStateError();\n          });\n        } // Bug #34: If the state was set to suspended before it should be revoked now.\n\n\n        if (this._state === 'suspended') {\n          this._state = null;\n        }\n\n        return this._nativeAudioContext.close().then(function () {\n          if (_this2._nativeGainNode !== null && _this2._nativeOscillatorNode !== null) {\n            _this2._nativeOscillatorNode.stop();\n\n            _this2._nativeGainNode.disconnect();\n\n            _this2._nativeOscillatorNode.disconnect();\n          }\n\n          deactivateAudioGraph(_this2);\n        });\n      }\n    }, {\n      key: \"createMediaElementSource\",\n      value: function createMediaElementSource(mediaElement) {\n        return new mediaElementAudioSourceNodeConstructor(this, {\n          mediaElement: mediaElement\n        });\n      }\n    }, {\n      key: \"createMediaStreamDestination\",\n      value: function createMediaStreamDestination() {\n        return new mediaStreamAudioDestinationNodeConstructor(this);\n      }\n    }, {\n      key: \"createMediaStreamSource\",\n      value: function createMediaStreamSource(mediaStream) {\n        return new mediaStreamAudioSourceNodeConstructor(this, {\n          mediaStream: mediaStream\n        });\n      }\n    }, {\n      key: \"createMediaStreamTrackSource\",\n      value: function createMediaStreamTrackSource(mediaStreamTrack) {\n        return new mediaStreamTrackAudioSourceNodeConstructor(this, {\n          mediaStreamTrack: mediaStreamTrack\n        });\n      }\n    }, {\n      key: \"resume\",\n      value: function resume() {\n        var _this3 = this;\n\n        if (this._state === 'suspended') {\n          return new Promise(function (resolve, reject) {\n            var resolvePromise = function resolvePromise() {\n              _this3._nativeAudioContext.removeEventListener('statechange', resolvePromise);\n\n              if (_this3._nativeAudioContext.state === 'running') {\n                resolve();\n              } else {\n                _this3.resume().then(resolve, reject);\n              }\n            };\n\n            _this3._nativeAudioContext.addEventListener('statechange', resolvePromise);\n          });\n        }\n\n        return this._nativeAudioContext.resume().catch(function (err) {\n          // Bug #55: Chrome, Edge and Opera do throw an InvalidAccessError instead of an InvalidStateError.\n          // Bug #56: Safari invokes the catch handler but without an error.\n          if (err === undefined || err.code === 15) {\n            throw createInvalidStateError();\n          }\n\n          throw err;\n        });\n      }\n    }, {\n      key: \"suspend\",\n      value: function suspend() {\n        return this._nativeAudioContext.suspend().catch(function (err) {\n          // Bug #56: Safari invokes the catch handler but without an error.\n          if (err === undefined) {\n            throw createInvalidStateError();\n          }\n\n          throw err;\n        });\n      }\n    }]);\n\n    return AudioContext;\n  }(baseAudioContextConstructor);\n};","map":{"version":3,"mappings":"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","names":["deactivateAudioGraph","isValidLatencyHint","createAudioContextConstructor","baseAudioContextConstructor","createInvalidStateError","createNotSupportedError","createUnknownError","mediaElementAudioSourceNodeConstructor","mediaStreamAudioDestinationNodeConstructor","mediaStreamAudioSourceNodeConstructor","mediaStreamTrackAudioSourceNodeConstructor","nativeAudioContextConstructor","options","Error","nativeAudioContext","err","code","message","latencyHint","TypeError","sampleRate","undefined","_baseLatency","baseLatency","Math","max","min","round","_nativeAudioContext","name","_nativeGainNode","createGain","_nativeOscillatorNode","createOscillator","gain","value","connect","destination","start","_state","state","revokeState","removeEventListener","addEventListener","close","then","stop","disconnect","mediaElement","mediaStream","mediaStreamTrack","Promise","resolve","reject","resolvePromise","resume","catch","suspend"],"sourceRoot":"","sources":["../../../src/factories/audio-context-constructor.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}