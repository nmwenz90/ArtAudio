{"ast":null,"code":"export var createEvaluateSource = function createEvaluateSource(window) {\n  return function (source) {\n    return new Promise(function (resolve, reject) {\n      if (window === null) {\n        // Bug #182 Chrome, Edge and Opera do throw an instance of a SyntaxError instead of a DOMException.\n        reject(new SyntaxError());\n        return;\n      }\n\n      var head = window.document.head;\n\n      if (head === null) {\n        // Bug #182 Chrome, Edge and Opera do throw an instance of a SyntaxError instead of a DOMException.\n        reject(new SyntaxError());\n      } else {\n        var script = window.document.createElement('script'); // @todo Safari doesn't like URLs with a type of 'application/javascript; charset=utf-8'.\n\n        var blob = new Blob([source], {\n          type: 'application/javascript'\n        });\n        var url = URL.createObjectURL(blob);\n        var originalOnErrorHandler = window.onerror;\n\n        var removeErrorEventListenerAndRevokeUrl = function removeErrorEventListenerAndRevokeUrl() {\n          window.onerror = originalOnErrorHandler;\n          URL.revokeObjectURL(url);\n        };\n\n        window.onerror = function (message, src, lineno, colno, error) {\n          // @todo Edge thinks the source is the one of the html document.\n          if (src === url || src === window.location.href && lineno === 1 && colno === 1) {\n            removeErrorEventListenerAndRevokeUrl();\n            reject(error);\n            return false;\n          }\n\n          if (originalOnErrorHandler !== null) {\n            return originalOnErrorHandler(message, src, lineno, colno, error);\n          }\n        };\n\n        script.onerror = function () {\n          removeErrorEventListenerAndRevokeUrl(); // Bug #182 Chrome, Edge and Opera do throw an instance of a SyntaxError instead of a DOMException.\n\n          reject(new SyntaxError());\n        };\n\n        script.onload = function () {\n          removeErrorEventListenerAndRevokeUrl();\n          resolve();\n        };\n\n        script.src = url;\n        script.type = 'module';\n        head.appendChild(script);\n      }\n    });\n  };\n};","map":{"version":3,"mappings":"AAEA,OAAO,IAAMA,oBAAoB,GAA2B,SAA/CA,oBAA+C,CAACC,MAAD,EAAW;AACnE,SAAO,UAACC,MAAD;AAAA,WACH,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAoB;AAC5B,UAAIJ,MAAM,KAAK,IAAf,EAAqB;AACjB;AACAI,cAAM,CAAC,IAAIC,WAAJ,EAAD,CAAN;AAEA;AACH;;AAED,UAAMC,IAAI,GAAGN,MAAM,CAACO,QAAP,CAAgBD,IAA7B;;AAEA,UAAIA,IAAI,KAAK,IAAb,EAAmB;AACf;AACAF,cAAM,CAAC,IAAIC,WAAJ,EAAD,CAAN;AACH,OAHD,MAGO;AACH,YAAMG,MAAM,GAAGR,MAAM,CAACO,QAAP,CAAgBE,aAAhB,CAA8B,QAA9B,CAAf,CADG,CAEH;;AACA,YAAMC,IAAI,GAAG,IAAIC,IAAJ,CAAS,CAACV,MAAD,CAAT,EAAmB;AAAEW,cAAI,EAAE;AAAR,SAAnB,CAAb;AACA,YAAMC,GAAG,GAAGC,GAAG,CAACC,eAAJ,CAAoBL,IAApB,CAAZ;AAEA,YAAMM,sBAAsB,GAAGhB,MAAM,CAACiB,OAAtC;;AAEA,YAAMC,oCAAoC,GAAG,SAAvCA,oCAAuC,GAAK;AAC9ClB,gBAAM,CAACiB,OAAP,GAAiBD,sBAAjB;AAEAF,aAAG,CAACK,eAAJ,CAAoBN,GAApB;AACH,SAJD;;AAMAb,cAAM,CAACiB,OAAP,GAAiB,UAACG,OAAD,EAAUC,GAAV,EAAeC,MAAf,EAAuBC,KAAvB,EAA8BC,KAA9B,EAAuC;AACpD;AACA,cAAIH,GAAG,KAAKR,GAAR,IAAgBQ,GAAG,KAAKrB,MAAM,CAACyB,QAAP,CAAgBC,IAAxB,IAAgCJ,MAAM,KAAK,CAA3C,IAAgDC,KAAK,KAAK,CAA9E,EAAkF;AAC9EL,gDAAoC;AACpCd,kBAAM,CAACoB,KAAD,CAAN;AAEA,mBAAO,KAAP;AACH;;AAED,cAAIR,sBAAsB,KAAK,IAA/B,EAAqC;AACjC,mBAAOA,sBAAsB,CAACI,OAAD,EAAUC,GAAV,EAAeC,MAAf,EAAuBC,KAAvB,EAA8BC,KAA9B,CAA7B;AACH;AACJ,SAZD;;AAcAhB,cAAM,CAACS,OAAP,GAAiB,YAAK;AAClBC,8CAAoC,GADlB,CAElB;;AACAd,gBAAM,CAAC,IAAIC,WAAJ,EAAD,CAAN;AACH,SAJD;;AAKAG,cAAM,CAACmB,MAAP,GAAgB,YAAK;AACjBT,8CAAoC;AACpCf,iBAAO;AACV,SAHD;;AAIAK,cAAM,CAACa,GAAP,GAAaR,GAAb;AACAL,cAAM,CAACI,IAAP,GAAc,QAAd;AAEAN,YAAI,CAACsB,WAAL,CAAiBpB,MAAjB;AACH;AACJ,KAvDD,CADG;AAAA,GAAP;AAyDH,CA1DM","names":["createEvaluateSource","window","source","Promise","resolve","reject","SyntaxError","head","document","script","createElement","blob","Blob","type","url","URL","createObjectURL","originalOnErrorHandler","onerror","removeErrorEventListenerAndRevokeUrl","revokeObjectURL","message","src","lineno","colno","error","location","href","onload","appendChild"],"sourceRoot":"","sources":["../../../src/factories/evaluate-source.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}