{"ast":null,"code":"import _classCallCheck from \"/Users/natewamwenze/Documents/personalProjects/musicidea/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/natewamwenze/Documents/personalProjects/musicidea/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _assertThisInitialized from \"/Users/natewamwenze/Documents/personalProjects/musicidea/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js\";\nimport _get from \"/Users/natewamwenze/Documents/personalProjects/musicidea/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/get.js\";\nimport _getPrototypeOf from \"/Users/natewamwenze/Documents/personalProjects/musicidea/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js\";\nimport _inherits from \"/Users/natewamwenze/Documents/personalProjects/musicidea/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper from \"/Users/natewamwenze/Documents/personalProjects/musicidea/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\nimport { ToneWithContext } from \"../context/ToneWithContext\";\nimport { Timeline } from \"./Timeline\";\nimport { onContextClose, onContextInit } from \"../context/ContextInitialization\";\n/**\n * Draw is useful for synchronizing visuals and audio events.\n * Callbacks from Tone.Transport or any of the Tone.Event classes\n * always happen _before_ the scheduled time and are not synchronized\n * to the animation frame so they are not good for triggering tightly\n * synchronized visuals and sound. Draw makes it easy to schedule\n * callbacks using the AudioContext time and uses requestAnimationFrame.\n * @example\n * Tone.Transport.schedule((time) => {\n * \t// use the time argument to schedule a callback with Draw\n * \tTone.Draw.schedule(() => {\n * \t\t// do drawing or DOM manipulation here\n * \t\tconsole.log(time);\n * \t}, time);\n * }, \"+0.5\");\n * Tone.Transport.start();\n * @category Core\n */\n\nexport var Draw = /*#__PURE__*/function (_ToneWithContext) {\n  _inherits(Draw, _ToneWithContext);\n\n  var _super = _createSuper(Draw);\n\n  function Draw() {\n    var _this;\n\n    _classCallCheck(this, Draw);\n\n    _this = _super.apply(this, arguments);\n    _this.name = \"Draw\";\n    /**\n     * The duration after which events are not invoked.\n     */\n\n    _this.expiration = 0.25;\n    /**\n     * The amount of time before the scheduled time\n     * that the callback can be invoked. Default is\n     * half the time of an animation frame (0.008 seconds).\n     */\n\n    _this.anticipation = 0.008;\n    /**\n     * All of the events.\n     */\n\n    _this._events = new Timeline();\n    /**\n     * The draw loop\n     */\n\n    _this._boundDrawLoop = _this._drawLoop.bind(_assertThisInitialized(_this));\n    /**\n     * The animation frame id\n     */\n\n    _this._animationFrame = -1;\n    return _this;\n  }\n  /**\n   * Schedule a function at the given time to be invoked\n   * on the nearest animation frame.\n   * @param  callback  Callback is invoked at the given time.\n   * @param  time      The time relative to the AudioContext time to invoke the callback.\n   * @example\n   * Tone.Transport.scheduleRepeat(time => {\n   * \tTone.Draw.schedule(() => console.log(time), time);\n   * }, 1);\n   * Tone.Transport.start();\n   */\n\n\n  _createClass(Draw, [{\n    key: \"schedule\",\n    value: function schedule(callback, time) {\n      this._events.add({\n        callback: callback,\n        time: this.toSeconds(time)\n      }); // start the draw loop on the first event\n\n\n      if (this._events.length === 1) {\n        this._animationFrame = requestAnimationFrame(this._boundDrawLoop);\n      }\n\n      return this;\n    }\n    /**\n     * Cancel events scheduled after the given time\n     * @param  after  Time after which scheduled events will be removed from the scheduling timeline.\n     */\n\n  }, {\n    key: \"cancel\",\n    value: function cancel(after) {\n      this._events.cancel(this.toSeconds(after));\n\n      return this;\n    }\n    /**\n     * The draw loop\n     */\n\n  }, {\n    key: \"_drawLoop\",\n    value: function _drawLoop() {\n      var now = this.context.currentTime;\n\n      while (this._events.length && this._events.peek().time - this.anticipation <= now) {\n        var event = this._events.shift();\n\n        if (event && now - event.time <= this.expiration) {\n          event.callback();\n        }\n      }\n\n      if (this._events.length > 0) {\n        this._animationFrame = requestAnimationFrame(this._boundDrawLoop);\n      }\n    }\n  }, {\n    key: \"dispose\",\n    value: function dispose() {\n      _get(_getPrototypeOf(Draw.prototype), \"dispose\", this).call(this);\n\n      this._events.dispose();\n\n      cancelAnimationFrame(this._animationFrame);\n      return this;\n    }\n  }]);\n\n  return Draw;\n}(ToneWithContext); //-------------------------------------\n// \tINITIALIZATION\n//-------------------------------------\n\nonContextInit(function (context) {\n  context.draw = new Draw({\n    context: context\n  });\n});\nonContextClose(function (context) {\n  context.draw.dispose();\n});","map":{"version":3,"mappings":";;;;;;;AAAA,SAASA,eAAT,QAAwD,4BAAxD;AAEA,SAASC,QAAT,QAAwC,YAAxC;AACA,SAASC,cAAT,EAAyBC,aAAzB,QAA8C,kCAA9C;AAMA;;;;;;;;;;;;;;;;;;;AAkBA,WAAaC,IAAb;AAAA;;AAAA;;AAAA;AAAA;;AAAA;;;AAEU,iBAAe,MAAf;AAET;;;;AAGA,uBAAsB,IAAtB;AAEA;;;;;;AAKA,yBAAwB,KAAxB;AAEA;;;;AAGQ,oBAA+B,IAAIH,QAAJ,EAA/B;AAER;;;;AAGQ,2BAAiB,MAAKI,SAAL,CAAeC,IAAf,+BAAjB;AAER;;;;AAGQ,4BAAkB,CAAC,CAAnB;AA7BT;AAqFC;AAtDA;;;;;;;;;;;;;AA/BD;AAAA;AAAA,WA0CC,kBAASC,QAAT,EAA+BC,IAA/B,EAAyC;AACxC,WAAKC,OAAL,CAAaC,GAAb,CAAiB;AAChBH,gBAAQ,EAARA,QADgB;AAEhBC,YAAI,EAAE,KAAKG,SAAL,CAAeH,IAAf;AAFU,OAAjB,EADwC,CAKxC;;;AACA,UAAI,KAAKC,OAAL,CAAaG,MAAb,KAAwB,CAA5B,EAA+B;AAC9B,aAAKC,eAAL,GAAuBC,qBAAqB,CAAC,KAAKC,cAAN,CAA5C;AACA;;AACD,aAAO,IAAP;AACA;AAED;;;;;AAtDD;AAAA;AAAA,WA0DC,gBAAOC,KAAP,EAAmB;AAClB,WAAKP,OAAL,CAAaQ,MAAb,CAAoB,KAAKN,SAAL,CAAeK,KAAf,CAApB;;AACA,aAAO,IAAP;AACA;AAED;;;;AA/DD;AAAA;AAAA,WAkES,qBAAS;AAChB,UAAME,GAAG,GAAG,KAAKC,OAAL,CAAaC,WAAzB;;AACA,aAAO,KAAKX,OAAL,CAAaG,MAAb,IAAwB,KAAKH,OAAL,CAAaY,IAAb,GAAkCb,IAAlC,GAAyC,KAAKc,YAA9C,IAA8DJ,GAA7F,EAAkG;AACjG,YAAMK,KAAK,GAAG,KAAKd,OAAL,CAAae,KAAb,EAAd;;AACA,YAAID,KAAK,IAAIL,GAAG,GAAGK,KAAK,CAACf,IAAZ,IAAoB,KAAKiB,UAAtC,EAAkD;AACjDF,eAAK,CAAChB,QAAN;AACA;AACD;;AACD,UAAI,KAAKE,OAAL,CAAaG,MAAb,GAAsB,CAA1B,EAA6B;AAC5B,aAAKC,eAAL,GAAuBC,qBAAqB,CAAC,KAAKC,cAAN,CAA5C;AACA;AACD;AA7EF;AAAA;AAAA,WA+EC,mBAAO;AACN;;AACA,WAAKN,OAAL,CAAaiB,OAAb;;AACAC,0BAAoB,CAAC,KAAKd,eAAN,CAApB;AACA,aAAO,IAAP;AACA;AApFF;;AAAA;AAAA,EAA0Bb,eAA1B,E,CAuFA;AACA;AACA;;AAEAG,aAAa,CAAC,iBAAO,EAAG;AACvBgB,SAAO,CAACS,IAAR,GAAe,IAAIxB,IAAJ,CAAS;AAAEe,WAAO,EAAPA;AAAF,GAAT,CAAf;AACA,CAFY,CAAb;AAIAjB,cAAc,CAAC,iBAAO,EAAG;AACxBiB,SAAO,CAACS,IAAR,CAAaF,OAAb;AACA,CAFa,CAAd","names":["ToneWithContext","Timeline","onContextClose","onContextInit","Draw","_drawLoop","bind","callback","time","_events","add","toSeconds","length","_animationFrame","requestAnimationFrame","_boundDrawLoop","after","cancel","now","context","currentTime","peek","anticipation","event","shift","expiration","dispose","cancelAnimationFrame","draw"],"sourceRoot":"","sources":["../../../../Tone/core/util/Draw.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}